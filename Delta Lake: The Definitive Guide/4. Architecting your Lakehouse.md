# 4. Architecting your Lakehouse
## The Lakehouse Architecture
### What is a Lakehouse?
> Lakehouse — это открытая архитектура управления данными, которая сочетает в себе гибкость, экономичность и масштаб озера данных (data lake) с управлением данными, соблюдением схемы и транзакциями ACID традиционного хранилища данных (data warehouse). 
### Learning from Data Warehouses
Хранилища данных появились, чтобы решить проблему разрозненности данных на крупных предприятиях и упростить бизнес-аналитику и принятие аналитических решений. Основная причина физических ограничений заключалась в том, что данные хранились локально (нераспределенно) в архитектуре вертикального масштабирования. Хранилища данных в первую очередь создаются для обеспечения согласованности данных.
### Learning from Data Lakes
Озера предназначены для хранения сырых данных в разных форматах файлов в распределенных файловых системах. Используя одни инструменты, можно использовать озеро как для распределенной обработки данных, так и для их загрузки уже в хранилище данных. Сильно дешевле хранилища, но сложно поддерживать согласованность данных.
### The Dual-Tier Data Architecture
Двухуровневая архитектура опирается на задания ETL для обеспечения согласованности. Например:
1. Записать данные из базы данных источника А в озеро данных (место А)
2. Прочитать, очистить и преобразовать данные из (место А) и записать изменения в (место Б)
3. Прочитать данные из (место Б), объединить с данными из (место В), записать в (место Г)
4. Прочитать данные из (место Г) и записать в хранилище данных для бизнес-аналитики
По завершению workflow данные в озере и хранилище будут синхронизированы. Таблицы в хранилище можно будет перезагружать и удалять, чтобы сократить рассходы.
### Lakehouse Architecture
Сочетание date lake и warehouse без двухуровневой архитектуры. Характерны:
1. Поддержка транзакций
2. Поддержка и управление схемой
3. Поддержка BI через интерфейс типа SQL
4. Разделение хранения и вычислений
5. Открытые стандарты: API и форматы
6. Потоковая обработка end-to-end
7. Поддержка разнообразных нагрузок
## Foundations with Delta Lake
### Open-Source on Open-Standards in an Open Ecosystem
Delta использует parquet, все решения открыто описаны.
### Transaction Support
Delta предоставляет гарантии ACID. Есть сериализация при записи, читаются снэпшоты, есть "отмотка времени".
### Schema Enforcement and Governance
Schema-On-Write и её декраративное изменение.
## The Medallion Architecture
Шаблон проектирования данных, используемый для логической организации данных в озерном домике. Это достигается с помощью серии изолированных слоев данных, обеспечивающих основу для поэтапной обратботки наборов данных. Основная причина использовать многоуровневую структуру - возможность восстановления, если что-то пойдет не так или изменятся требования.
### Exploring the Bronze Layer
Начальная точка передачи данных. Минимум преобразований, оставляем данные максимально сырыми: чтобы иметь возможность их полностью обработать заного.
### Exploring the Silver Layer
В серебрянном слое необработанные данные из брозового слоя фильтруются, очищаются, обрабатываются и даже дополняются через объединение таблиц.
### Exploring the Gold Layer
В золотом слое данные поддерживаются и создаются с целью решения конкретных целей.
## Streaming Medallion Architecture
Delta поддерживает потоковое и пакетное чтение таблиц. Для организации потоков можно использовать Airflow или другой оркестратор.
## Summary
Delta позволяет легко создать lakehouse: архитектуру, сочетающую достоинства data lake и warehouse. При низкой стоимости хранения, высокой способности к масштабированию, добавляется возможность поддерживать данные в согласованном виде.
Архитектура медальона даёт нам необходимые гарантии и ожидания от данных, основанные на поэтапной обработке от бронзового до золотого уровней. 

_Я уже несколько раз строил архитектуру медальона: например этапы агрегации, классифицации и предобработки товаров перед формированием Глобального Каталога._