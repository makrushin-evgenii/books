# Глава 8. Операции соединения
## Соединение данных выбросов в реальном времени
## Задание контроля выбросов, версия 1
## Преобразователь данных о выбросах
Использование данных из базы данных по параметрам события тоже можно назвать объединением. Но в главе будут рассматриваться именно объединения потоков.
## Точность становится проблеммой
## Обновленное задание контроля выбросов
Потоки событий автомобилей и событий температуры будут объединяться в реальном времени.
## Все внимание на соединение
События поступаю не синхронно. Источник событий автомобилей получает данные от автомобилей с минутным интервалом. Источник событий температуры получает события от датчиков с 10-минутным интервалом.
## Еще раз: что такое соединение?
Соединение позволяет данные из одного множества и объединить их с данным из другого множества по заданому правилу.
## Как работает стриминговое соединение
Для соединения двух потоков, один поток нужно преобразовать в таблицу. Таблица является временной и изменяемой.
## Соединение (join) потоков - разновидность объединения (fan-in)
Если оператор обрабатывает несколько потоков с одинаковыми типами событий, и делает это одинаково, это - оператор слияния (union).
Если оператор обрабатывает несколько потоков с разными типами событий, и делает это по разному, это - оператор соединения (join).
Оба оператора - операторы объединения (fan-in).
## События автомобилей и события температуры
Преобразовывать в таблицу стоит вспомогательный, меньший поток. Это требует меньше ресурсов и удобнее.
## Таблица как материализованное представление стриминга
Так как интересна только последняя температура, таблица не будет расти с каждым новым событием.
Каждое событие температуры - изменение данных в таблице, поток событий - журнал изменений, а сама таблица - материализованное представление.
## Материализация событий автомобилей менее эффективна
Материализация событий автомобилей менее эффективна, потому что каждое новое событие будет увеличивать таблицу.
## Проблемы с целостностью данных
## Проблемы с оператором соединения
## Внутреннее соединение
Внутреннее соединение включет только события, для которых есть данные во втором потоке.
## Внешнее соединение
Внешнее соединение включает все события.
## Внутренние и внешние соединения
## Разные типы соединений
Внутренние (inner) соединения возвращают только те результаты, для которых существуют соответсвующие значения в обеих таблицах.
Полные внешние (full outer) соединения возвращают все результаты из обеих таблиц.
Левые внешние (left outer) соединения возвращают все результаты из левой таблицы и только соответствующие строки из правой. Правые внешние (right outer) - наоборот.
## Внешние соединения в стриминговых системах
Обычно события одного из потоков обрабатываются последовательно, а из других - материализуются в таблицы. Первый поток считается левым, материализуемые - правыми.
## Новая проблема: ненадежное соединение
## Оконные соединения
Оконное соединение предполагает материализацию правого потока в фиксированном окне каждый раз в новую таблицу. 
Так в каждой таблице не будет неактуальных данных, которые могут влиять на точность. Вырастет задержка, но повысится точность.
## Соединение двух таблиц вместо соединения потока с таблицей
## Снова о материализации представлений
Материализация представления - популярный паттерн оптимизации в приложениях обработки данных. Объединять потоки можно и без него, но это будет дорого и неэффективно.
## Итоги
Внутренние соединения возвращают только те результаты, которые имеют соответствующие значения в обеих таблицах. Внешние соединения возвращают результаты независимо от того, присутствуют соответствующие данные в обеих таблицах или нет. Существуют три разновидности внешних соединений: полные, левые и правые.
Для обьединения двух потоков, один обычно материализуется. Материализуемый поток считается правым, основной - левым.
