# Глава 11. Продвинутые концепции в стриминговых системах
## Оконные вычисления
Иногда может быть полезно группировать события — по времени или по количеству.
## Основные виды окон
**Фиксированные** временные окна определяеются неизменяемым интервалом времени, количественные - количеством событий.
**Скользящие** окна от фиксированных отличаются интервалом смещения (slide interval). Новое окно создаётся не при завершении предыдущего, а через каждый интервал смещения. Интервалы окна и смещения позволяют окнам перекрываться, из-за чего каждое событие может быть включено в несколько окон.
**Сеансовые** окна определяются максимальной продолжительностью тайм-аута. Если интервал между транзакциями превышает длину тайм-аута, то существующее окно закрывается и открывается новое окно.
## Соединение данных в реальном времени
## SQL и стриминговые соединения
В одном из типичных решений один входящий поток работает как поток, а другой поток (или потоки) преобразуется во временную таблицу в памяти. Эта таблица может рассматриваться как материализованное представление потока.
## Внутренние и внешние соединения
Внутренние соединения возвращают только результаты, у которых имеются соответствующие значения в обеих таблицах.
Полные внешние соединения возвращают все результаты из обеих таблиц.
Левые внешние соединения возвращают все результаты из таблицы событий автомобилей и только соответствующие строки из таблицы температур.
Правые внешние соединения возвращают все результаты из таблицы температур и только соответствующие строки из таблицы событий автомобилей.
## Неожиданности в стриминговых системах
## Обратное давление: замедление источников или предшествующих компонентов
Обратное давление действует в направлении, обратном направлению следования данных, и замедляет трафик событий. В книге были рассмотрены два способа создания обратного давления: остановка источников и остановка предшествующих компонентов.
## Другой подход к управлению отстающими экземплярами: отбрасывание событий
В этом варианте при отставании экземпляра вместо того, чтобы останавливать и возобновлять обработку источника предшествующих компонентов, система будет просто отбрасывать новые события, передаваемые экземпляру.
## Обратное давление может быть симптомом постоянной проблемы
**Экземпляр перестает работать, и обратное давление не снимается**. В этом случае события не уходят из очереди и состояние обратного давления никогда не будет снято.
**Экземпляр не справляется, обратное давление возникает снова: пробуксовка**. Если в системе наблюдается пробуксовка, выясните, почему экземпляр не обрабатывает события с нужной скоростью.
## Компоненты с состоянием и контрольные точки
Компоненты с состоянием позволяют воссоздать контекст, так что компоненты возобновляют обработку с состояния, в котором она была остановлена ранее.
## Событийный отсчет времени
Все экземпляры в стриминговом задании должны зафиксировать свое состояние одновременно, чтобы при необходимости задание можно было восстановить в состоянии на предыдущий момент времени. В этом случае используется не абсолютное, а событийное время.
## Компоненты с состоянием и компоненты без состояния
Компоненты с состояние точнее (возможна семантика "ровно один"), но требуют больше ресурсов и сложнее масштабируются, чем компоненты без состояния.